<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The mcfg Book</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="mcfg: Machine Configurator, a cross-platform meta-package manager.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="src/additional.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction/index.html"><strong aria-hidden="true">1.</strong> Introduction</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="introduction/start-here.html"><strong aria-hidden="true">1.1.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="introduction/tool.html"><strong aria-hidden="true">1.2.</strong> The CLI tool</a></li><li class="chapter-item expanded "><a href="introduction/library.html"><strong aria-hidden="true">1.3.</strong> The library API</a></li></ol></li><li class="chapter-item expanded "><a href="repository/index.html"><strong aria-hidden="true">2.</strong> The package set repository</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="repository/packages.html"><strong aria-hidden="true">2.1.</strong> Packages</a></li><li class="chapter-item expanded "><a href="repository/package-sets.html"><strong aria-hidden="true">2.2.</strong> Packages sets</a></li><li class="chapter-item expanded "><a href="repository/package-set-groups.html"><strong aria-hidden="true">2.3.</strong> Package set groups</a></li></ol></li><li class="chapter-item expanded "><a href="installers/index.html"><strong aria-hidden="true">3.</strong> The installer registry</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installers/installing.html"><strong aria-hidden="true">3.1.</strong> Installing installers</a></li></ol></li><li class="chapter-item expanded "><a href="scripts/index.html"><strong aria-hidden="true">4.</strong> Script strings</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="scripts/variables.html"><strong aria-hidden="true">4.1.</strong> Variables</a></li></ol></li><li class="chapter-item expanded "><a href="tool/index.html"><strong aria-hidden="true">5.</strong> The mcfg CLI</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tool/actions.html"><strong aria-hidden="true">5.1.</strong> Actions</a></li><li class="chapter-item expanded "><a href="tool/existing.html"><strong aria-hidden="true">5.2.</strong> Using existing actions</a></li><li class="chapter-item expanded "><a href="tool/new.html"><strong aria-hidden="true">5.3.</strong> Adding new actions</a></li></ol></li><li class="chapter-item expanded "><a href="appendices/package-sets.html"><strong aria-hidden="true">6.</strong> Appendix: Example package sets</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The mcfg Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/johnstonskj/rust-mcfg" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>The <code>mcfg</code> crate and command-line tool, implements a simple <em>Machine Configurator</em> or meta-package manager to keep 
desktop environments the same across machines and wherever possible across operating systems. The tool makes use of 
existing package managers such as <a href="https://brew.sh/">homebrew</a>, <a href="https://en.wikipedia.org/wiki/APT_(software)">apt</a>, 
or <a href="https://en.wikipedia.org/wiki/Yum_(software)">yum</a>. It allows for packages to be grouped into package sets which
are the units of management and then package sets into groups for simple organization.</p>
<p>The tool keeps all of it's package sets organized in a repository which just happens to be a Git repo and so can 
be versioned and easily shared between machines. It allows for the specification of different installer tools that
will be used to do actual package management, so the user doesn't need to remember specific command-lines or other
details. This repo can also include any additional scripts or tools the user needs, and the execution of the package
set includes a set of environment variables to allow scripts to run without knowing any O/S or machine specific 
paths or other details.</p>
<h2><a class="header" href="#goals-and-non-goals" id="goals-and-non-goals">Goals and non-goals</a></h2>
<p>The intent is to provide a light-weigh way to describe the installation of a lot of related packages, scripts, and
customizations that comprise a machine environment. Specifically this was developed for keeping developer desktops
as close as possible between different laptop or desktop machines and between Linux and macOS systems.</p>
<p>The intent is also to <em>not</em>:</p>
<ul>
<li>Be a package manager itself; package sets are simply logical higher-level grouping of packages but rely solely on the 
underlying package manager.</li>
<li>Be a sync mechanism; the CLI does not sync automatically, refreshing the package repository and running update and
install actions are still manual steps.</li>
<li>Be atomic; there is no roll-back mechanism on failure.</li>
</ul>
<h2><a class="header" href="#current-status" id="current-status">Current status</a></h2>
<ul>
<li>Basic operations working, not yet ready for more use than that.</li>
</ul>
<h1><a class="header" href="#getting-started" id="getting-started">Getting Started</a></h1>
<p>To use the <code>mcfg</code> tool you need a package repository and an installer registry. Your package repository is a directory
containing the configuration you want to use for your machine, the installer registry provides details of the tools
used to actually install individual packages. The tool expects that the package repository is also a Git repository,
this being the mechanism to share your repository across machines. For first use, the tool has an <strong>init</strong> command 
that we will demonstrate below.</p>
<h2><a class="header" href="#install" id="install">Install</a></h2>
<p>TBD</p>
<h2><a class="header" href="#initialize-your-repository" id="initialize-your-repository">Initialize your repository</a></h2>
<p>To initialize a new repository, on a new machine, using the system defaults for configuration and data paths the 
following is all that is necessary.</p>
<pre><code class="language-text">$ mcfg init
1. Creating local directory for repository
2. Initializing Git repository
3. Creating repository '.config' directory
4. Creating repository '.local' directory
5. Creating '00-installers/homebrew' package set
6. Creating '00-installers/homebrew-services' package set
7. Creating 'example/hello world' package set
8. Creating standard installer registry file
9. Creating package install log file
Done.
</code></pre>
<p>Step number 2 is important, after creating the repository directory it will perform the equivalent of a <code>git init</code> 
command. This sets up the versioning for the repository but obviously as this repository has no upstream origin 
we can't push changes until we make that connection.</p>
<p>Alternatively you can provide the URL to an existing Git repository which will be cloned into the package repository
directory.</p>
<pre><code class="language-text">$ mcfg init -r https://github.com/simon/mcfg-repo.git
1. Creating local directory for repository
2. Cloning &lt;https://github.com/simon/mcfg-repo.git&gt; into repository
3. Creating repository '.config' directory
4. Creating repository '.local' directory
5. Creating '00-installers/homebrew' package set
6. Creating '00-installers/homebrew-services' package set
7. Creating 'example/hello world' package set
8. Creating standard installer registry file
9. Creating package install log file
</code></pre>
<p>Finally, if you would rather keep your actual Git repository in a known place outside the standard directory 
structure you can specify a local directory (with the <code>-l</code> argument) and a symlink will be created from the standard
repository location to your local Git directory.</p>
<pre><code class="language-text">$ mcfg init -r https://github.com/fakeuser/mcfg-repo.git -l $HOME/mcfg-repo
</code></pre>
<h3><a class="header" href="#paths" id="paths">Paths</a></h3>
<p>To show all the paths that the tool uses, the <code>paths</code> command will list them all.</p>
<pre><code class="language-text">$ mcfg paths
Package Repository path:
	&quot;/Users/simon/Library/Application Support/mcfg/repository&quot;
Package Repository symlinked to:
	&quot;/Users/simon/dotfiles-2&quot;
Package Repository config file path:
	&quot;/Users/simon/Library/Application Support/mcfg/repository/.config&quot;
Package Repository local file path:
	&quot;/Users/simon/Library/Application Support/mcfg/repository/.local&quot;
Installer Registry path:
	&quot;/Users/simon/Library/Application Support/mcfg/installers.yml&quot;
Package Installer log file path:
	&quot;/Users/simon/Library/Logs/mcfg/install-log.sql&quot;
</code></pre>
<h2><a class="header" href="#add-package-sets" id="add-package-sets">Add Package Sets</a></h2>
<p>The command <code>add &lt;group&gt; &lt;package-set&gt;</code> will create a new group if one doesn't already exist, a directory for the 
package set name and finally a <code>package-set.yml</code> file within this. If the <code>-a/--as-file</code> flag is set the tool will 
create a new group if one doesn't already exist, and a file name + <code>.yml</code>. After creating the package set the tool will 
execute an editor to edit the template package set file it created. </p>
<p>Alternatively the <code>shell</code> command can be used to start an interactive shell in the repository document so you can
create groups and package set files more manually.</p>
<h2><a class="header" href="#install-1" id="install-1">Install!</a></h2>
<p>Once you</p>
<pre><code class="language-text">$ mcfg install
</code></pre>
<h1><a class="header" href="#the-cli-tool" id="the-cli-tool">The CLI tool</a></h1>
<pre><code class="language-text">$ mcfg help
mcfg 0.1.0
Machine configurator.

USAGE:
    mcfg [FLAGS] &lt;SUBCOMMAND&gt;

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information
    -v, --verbose    The level of logging to perform; from off to trace

SUBCOMMANDS:
    add            Add a new package-set to the local repository
    edit           Add an existing package-set in the local repository
    help           Prints this message or the help of the given subcommand(s)
    history        Show a history of install actions on the local machine
    init           Initialize a repository to manage package-set installs
    install        Install package-sets as described in the local repository
    installers     Edit the current installer registry file
    link-files     Link any files specified in package-sets as described in the local repository
    list           List package-sets in the local repository
    paths          Show current path locations
    refresh        Refresh the current repository
    remove         Remove an existing package-set from the local repository
    shell          Run a shell in the repository directory, with a basic script environment
    uninstall      Uninstall package-sets as described in the local repository
    update         Update package-sets as described in the local repository
    update-self    Show the current configuration
</code></pre>
<p>These can be grouped into those that 1) act on the package repository, 2) those that act on package sets, and 3) those
that act on the installer registry.</p>
<h2><a class="header" href="#package-repository-commands" id="package-repository-commands">Package repository commands</a></h2>
<p><strong>add</strong> a new package set to the repository; either creating a directory for the package set with a single file named 
<code>package-set.yml</code>, <em>or</em> if the <code>-a/--as-file</code> flag is set the file will be named for the package-set in the group 
directory.</p>
<p><strong>edit</strong> an existing package set in the repository, this will look for a file in the following order:</p>
<ol>
<li><code>{{group}}/{{package_set}}/package-set.yml</code></li>
<li><code>{{group}}/{{package_set}}.yml</code></li>
</ol>
<p><strong>init</strong>-ialize the repository, creating the repository, adding the default installer registry, and log file.</p>
<p><strong>list</strong> the repository contents, as a hierarchy with groups and package sets. By default it will list all groups, the
<code>-g/--group</code> argument can be set to list only the contents of the named group.</p>
<p>show the configured <strong>paths</strong> for the current package repository, installer registry, and log file. </p>
<p><strong>remove</strong> an existing package set from the repository.</p>
<p><strong>refresh</strong> the Git repository.</p>
<p>Run a <strong>shell</strong> within the package repository directory, with the default set of script environment variables set. This
is useful for testing scripts and doing repository edit/Git actions.</p>
<h2><a class="header" href="#package-set-commands" id="package-set-commands">Package set commands</a></h2>
<p>All the following commands take both <code>-g/--group</code> and <code>-p/--package-set</code> arguments, resulting in the following behavior:</p>
<ol>
<li>If neither is set the tool attempts to act on all groups, and all required package sets in each group.</li>
<li>If only the group is specified the tool attempts to act on all required package sets in thee specified group.</li>
<li>If both are specified, the tool attempts to act on the specified package set in the specified group and will also
act even if the package set is marked as optional.</li>
</ol>
<p><strong>install</strong> the package set(s); this will attempt to install even if previously installed, and the behavior of such is
dependent on the installer.</p>
<p><strong>link-files</strong> specified in the package set(s), performing no other actions - specifically neither the <code>run-before</code> or 
<code>run-after</code> script strings are run.</p>
<p><strong>uninstall</strong> package set(s) from the repository; the behavior of this if the package is not previously installed is
dependent on the installer.</p>
<p><strong>update</strong> package set(s) to their latest version; the behavior of this if the package is not previously installed is
dependent on the installer.</p>
<h2><a class="header" href="#installer-commands" id="installer-commands">Installer commands</a></h2>
<p>Show a <strong>history</strong> of all package install actions. The <code>-l/--limit</code> argument can be used to return only a number of most 
recent entries from the log.</p>
<p>Edit the <strong>installers</strong> in the registry file.</p>
<p>Ask all installers in the registry to <strong>update-self</strong>.</p>
<h1><a class="header" href="#the-library-api" id="the-library-api">The library API</a></h1>
<p>TBD</p>
<h1><a class="header" href="#the-package-set-repository" id="the-package-set-repository">The Package Set Repository</a></h1>
<pre><code class="language-text">$HOME/
├─ .config/
│  └─ mcfg/
│     └─ installers.yml
└─ .local/
   └─ share/
      └─ mcfg/
         ├─ logs/
         │  └─ install-log.sql
         └─ repository/
            ├─ .config/
            ├─ .git/  
            └─ .local/
</code></pre>
<pre><code class="language-text">$HOME/
├─ .config/
│  └─ mcfg/
│     └─ installers.yml
├─ .local/
│  └─ share/
│     └─ mcfg/
│        ├─ logs/
│        │  └─ install-log.sql
│        └─ repository/  -&gt;  $HOME/mcfg-repo-simon/
└─ mcfg-repo-simon/
   ├─ .config/
   ├─ .git/  
   └─ .local/
</code></pre>
<pre><code class="language-text">$HOME/
└─ Library/
   ├─ Application Support/
   │  └─ mcfg/
   │     ├─ installers.yml
   │     └─ repository/
   │        ├─ .config/
   │        ├─ .git/  
   │        └─ .local/
   └─ Logs/
      └─ mcfg/
         └─ install-log.sql
</code></pre>
<h2><a class="header" href="#example-packagerepository-api" id="example-packagerepository-api">Example PackageRepository API</a></h2>
<pre><pre class="playpen"><code class="language-rust no_run">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>use mcfg::shared::PackageRepository;

let package_repository = PackageRepository::open().unwrap();
<span class="boring">}
</span></code></pre></pre>
<h1><a class="header" href="#packages" id="packages">Packages</a></h1>
<p>Packages are described within a <a href="repository/./package-sets.html">package set</a>, they have the following p properties:</p>
<ul>
<li>A name.</li>
<li>An optional platform specification.</li>
<li>An optional package kind specification.</li>
</ul>
<h2><a class="header" href="#platforms" id="platforms">Platforms</a></h2>
<p>The platform value, typed as <code>Option&lt;mcfg::shared::Platform&gt;</code>, specifies whether a package is only applicable for one 
of the supported operating system and where <code>None</code> implies no restriction, it should be installed for all.</p>
<h2><a class="header" href="#package-kinds" id="package-kinds">Package Kinds</a></h2>
<p>The package kind value, typed as <code>mcfg::shared::PackageKind</code>, specifies the kind of installer to use for this
package.</p>
<ul>
<li>application</li>
<li>default</li>
<li>language</li>
<li>script</li>
</ul>
<h1><a class="header" href="#packages-sets" id="packages-sets">Packages Sets</a></h1>
<p>A package set is described in a YAML file, usually named <code>package-set.yml</code> and which contains the following properties.</p>
<ul>
<li>A name, and optional description.</li>
<li>A flag denoting whether the package set is optional. </li>
<li>An optional script line to run before any other action.</li>
<li><strong>Either</strong>:
<ul>
<li>A list of <a href="repository/./packages.html">packages</a> to be installed by their respective installers.</li>
<li>A set of keyed <a href="repository/package-sets.html#scripts">scripts</a> executed during different installer actions.</li>
</ul>
</li>
<li>An optional name for an <em>env file</em> to link into the user's configuration space.</li>
<li>An optional map of files to be symbolically linked into the user's file system.</li>
<li>An optional script line to run after all other actions.</li>
</ul>
<p>A number of examples are described in <a href="repository/../appendices/package-sets.html">Example package sets</a> appendix.</p>
<h2><a class="header" href="#example-package-set-file" id="example-package-set-file">Example Package Set file</a></h2>
<pre><code class="language-yaml">name: lux
env-file: sample.env
actions:
  packages:
    - name: lux
      kind:
        language: python
link-files:
  set-lux: &quot;{{local-bin}}/set-lux&quot;
</code></pre>
<h2><a class="header" href="#env-variables" id="env-variables">Env variables</a></h2>
<h2><a class="header" href="#package-actions" id="package-actions">Package actions</a></h2>
<h2><a class="header" href="#script-actions" id="script-actions">Script actions</a></h2>
<h1><a class="header" href="#run-before-and-run-after-script-strings" id="run-before-and-run-after-script-strings">Run-before and run-after script strings</a></h1>
<h2><a class="header" href="#env-files" id="env-files">Env files</a></h2>
<h2><a class="header" href="#link-files" id="link-files">Link files</a></h2>
<h1><a class="header" href="#package-set-groups" id="package-set-groups">Package Set Groups</a></h1>
<h2><a class="header" href="#naming" id="naming">Naming</a></h2>
<p><code>^([0-9]+\-)?(.*)$</code></p>
<ol>
<li>A set of package-set groups, these are basically all the directories under the repository
directory. Certain directories, such as <code>.git</code>, will be ignored.</li>
<li>A set of package-sets, these are within the group directories and are of one of two forms:
<ol>
<li>a directory containing a file with the name <code>package-set.yml</code>, or</li>
<li>a file in the group directory with the <code>.yml</code> extension.</li>
</ol>
</li>
</ol>
<pre><code class="language-text">$HOME/
└─ .local/
   └─ share/
      └─ mcfg/
         └─ repository/
            ├─ .config/
            ├─ .git/  
            ├─ .local/
            ├─ 01-operating-system/
            ├─ 02-developer-stuff/
            ├─ 03-productivity-stuff/
            └─ 04-work-stuff/
</code></pre>
<h1><a class="header" href="#the-installer-registry" id="the-installer-registry">The Installer Registry</a></h1>
<h2><a class="header" href="#example-installer-registry-file" id="example-installer-registry-file">Example Installer Registry file</a></h2>
<pre><code class="language-yaml">- name: homebrew
  platform: macos
  kind: default
  commands:
    install: &quot;brew install {{package}}&quot;
    uninstall: &quot;brew uninstall {{package}}&quot;
    update-self: &quot;brew upgrade&quot;
    update: &quot;brew update {{package}}&quot;

- name: homebrew apps
  platform: macos
  kind: application
  commands:
    install: &quot;brew cask install {{package}}&quot;
    uninstall: &quot;brew cask uninstall {{package}}&quot;
    update-self: &quot;brew upgrade&quot;
    update: &quot;brew cask update {{package}}&quot;

- name: cargo
  kind:
    language: rust
  commands:
    install: &quot;cargo install {{package}}&quot;
    uninstall: &quot;cargo uninstall {{package}}&quot;
</code></pre>
<h2><a class="header" href="#example-installerregistry-api" id="example-installerregistry-api">Example InstallerRegistry API</a></h2>
<pre><pre class="playpen"><code class="language-rust no_run">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>use mcfg::shared::InstallerRegistry;

let installer_registry = InstallerRegistry::open().unwrap();
<span class="boring">}
</span></code></pre></pre>
<h1><a class="header" href="#installing-installers" id="installing-installers">Installing installers</a></h1>
<p>TBD</p>
<h1><a class="header" href="#script-strings" id="script-strings">Script strings</a></h1>
<p>Package installers, and package sets, have a number of properties that are intended to execute commands. These are
simple YAML strings, but some parsing has to be done to ensure correct handling of a number of possibilities.</p>
<p>A simple self-contained command, no shell interpretation or variable substitution.</p>
<pre><code class="language-yaml">- name: homebrew
  commands:
    update-self: &quot;brew upgrade&quot;
</code></pre>
<p>A simple command, but parameterized using one or more of the standard script variables.</p>
<pre><code class="language-yaml">- name: homebrew
  commands:
    install: &quot;brew install {{package}}&quot;
</code></pre>
<h2><a class="header" href="#usage-in-installers" id="usage-in-installers">Usage in installers</a></h2>
<h2><a class="header" href="#usage-in-package-sets" id="usage-in-package-sets">Usage in package sets</a></h2>
<h1><a class="header" href="#variables" id="variables">Variables</a></h1>
<p>All of these variables are also set as environment variables to be used inside any running script. Each variable name
is upper-cased and prefixed with &quot;MCFG_&quot;, so <code>command_action</code> becomes <code>MCFG_COMMAND_ACTION</code>.</p>
<h2><a class="header" href="#default-variables" id="default-variables">Default variables</a></h2>
<ul>
<li><code>home</code> - the current user's home directory, usually equivalent to <code>$HOME</code>.</li>
<li><code>command_log_level</code> - the name of the current log level, if a command wishes to do any logging of it's own.</li>
<li><code>command_shell</code> - the name of the command shell used to execute script strings.</li>
<li><code>local_download_path</code> - the name of the user's local download directory.</li>
<li><code>platform</code> - the value of the <code>Platform</code> enum.</li>
<li><code>platform_family</code> - the operating system family, defined by Rust.</li>
<li><code>platform_os</code> - the operating system ID, defined by Rust.</li>
<li><code>platform_arch</code> - the system architecture ID, defined by Rust.</li>
<li><code>repo_config_path</code> - the path within the package repository for config files.</li>
<li><code>repo_local_path</code> - the path within the package repository for local files, including the <code>bin</code> directory.</li>
</ul>
<h2><a class="header" href="#action-variables" id="action-variables">Action variables</a></h2>
<ul>
<li><code>command_action</code> - the kind of action being performed; one of <code>install</code>, <code>link-files</code>,
<code>update</code>, or <code>uninstall</code>.</li>
</ul>
<h2><a class="header" href="#package-set-variables" id="package-set-variables">Package set variables</a></h2>
<ul>
<li><code>package_set_name</code> - the name of the package set being actioned.</li>
<li><code>package_set_file</code> - the name of the package set file, this is within <code>package_set_path</code></li>
<li><code>package_set_path</code> - the directory containing the package set file.</li>
</ul>
<h2><a class="header" href="#package-variables" id="package-variables">Package variables</a></h2>
<ul>
<li><code>package_name</code> - the name of the package being actioned.</li>
<li><code>package_config_path</code> - the current user's local configuration path for this package.</li>
<li><code>package_data_local_path</code> - the current user's local data path for this package.</li>
<li><code>package_log_path</code> - the full path to the installer log file.</li>
</ul>
<h2><a class="header" href="#user-defined-variables" id="user-defined-variables">User-defined variables</a></h2>
<h1><a class="header" href="#the-mcfg-tool" id="the-mcfg-tool">The mcfg Tool</a></h1>
<h1><a class="header" href="#actions" id="actions">Actions</a></h1>
<p>An action is a unit of work executed by a command in the CLI. It is simply a rust type that implements the following 
trait.</p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>pub trait Action: Debug {
    /// Run this action, this assumes all information was passed to the action during creation.
    fn run(&amp;self) -&gt; Result&lt;()&gt;;
}
<span class="boring">}
</span></code></pre></pre>
<h1><a class="header" href="#using-existing-actions" id="using-existing-actions">Using existing actions</a></h1>
<ul>
<li>HistoryAction</li>
<li>InitAction</li>
<li>InstallAction</li>
<li>EditInstallersAction</li>
<li>ListAction</li>
<li>ManageAction</li>
<li>ShowPathsAction</li>
<li>RefreshAction</li>
<li>ShellAction</li>
<li>UpdateSelfAction</li>
</ul>
<h2><a class="header" href="#example-calling-installaction" id="example-calling-installaction">Example calling InstallAction</a></h2>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>use mcfg::actions::InstallAction;
use mcfg::shared::Environment;

<span class="boring">fn wrapper() {
</span>let env = Environment::default();

let action = InstallAction::install(
    env,
    Some(&quot;work-tools&quot;.to_string()),
    Some(&quot;productivity&quot;.to_string())).unwrap();

action.run().unwrap();
<span class="boring">}
</span><span class="boring">}
</span></code></pre></pre>
<h1><a class="header" href="#adding-new-actions" id="adding-new-actions">Adding new actions</a></h1>
<p>The following is an example <code>Action</code> implementation that does very little.</p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>use mcfg::actions::Action;
use mcfg::error::Result;
use mcfg::shared::Environment;

#[derive(Debug)]
pub struct ExampleAction {
    env: Environment,
}

impl Action for ExampleAction {
    fn run(&amp;self) -&gt; Result&lt;()&gt; {
        println!(&quot;ListAction::run {:?}&quot;, self);
        Ok(())
    }
}
impl ExampleAction {
    pub fn new(env: Environment) -&gt; Result&lt;Box&lt;dyn Action&gt;&gt; {
        Ok(Box::from(ExampleAction { env }))
    }
}
<span class="boring">}
</span></code></pre></pre>
<h1><a class="header" href="#appendix-example-package-sets" id="appendix-example-package-sets">Appendix: Example package sets</a></h1>
<p>The following are package-sets that can be useful starting places.</p>
<h2><a class="header" href="#example-installing-homebrew-via-curl" id="example-installing-homebrew-via-curl">Example: installing homebrew via curl</a></h2>
<pre><code class="language-yaml">---
name: homebrew
platform: macos
description: macOS homebrew package manager
actions:
  scripts:
    install: &quot;curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh | bash&quot;
</code></pre>
<h2><a class="header" href="#example-setting-macos-experience-defaults" id="example-setting-macos-experience-defaults">Example: setting macOS experience defaults</a></h2>
<pre><code class="language-yaml">---
name: macos defaults
platform: macos
actions:
  scripts:
    install: &gt;-
      defaults write com.apple.dashboard devmode YES &amp;&amp;
      defaults write com.apple.finder _FXShowPosixPathInTitle -bool YES &amp;&amp;
      defaults write com.apple.Dock showhidden -bool YES
</code></pre>
<h2><a class="header" href="#example-a-long-list-of-packages" id="example-a-long-list-of-packages">Example: a long list of packages</a></h2>
<pre><code class="language-yaml">name: fonts
description: all those missing fonts!
actions:
  packages:
    - name: homebrew/cask-fonts/font-fira-code
      platform: macos
      kind: application
    - name: homebrew/cask-fonts/font-fira-code-nerd-font
      platform: macos
      kind: application
    - name: font-meslo-lg
      platform: macos
      kind: application
    - name: font-meslo-lg-nerd-font
      platform: macos
      kind: application
    - name: font-linux-libertine
      platform: macos
      kind: application
    - name: fonts-powerline
      platform: linux
</code></pre>
<h2><a class="header" href="#example-linking-files-and-run-after" id="example-linking-files-and-run-after">Example: linking files and run-after</a></h2>
<pre><code class="language-yaml">---
name: zsh
description: the Z shell
actions:
  packages:
    - name: zsh
    - name: zsh-completions
    - name: zsh-navigation-tools
      platform: macos
link-files:
  dot-zlogin: &quot;{{home}}/.zlogin&quot;
  dot-zshenv: &quot;{{home}}/.zshenv&quot;
  dot-zshrc: &quot;{{home}}/.zshrc&quot;
run-after: &quot;{{package_set_path}}/run-after&quot;
</code></pre>
<h2><a class="header" href="#example-custom-variables" id="example-custom-variables">Example: custom variables</a></h2>
<pre><code class="language-yaml">---
name: gpg
description: Gnu Privacy Guard
env-vars:
  gpg_home: &quot;{{home}}/.gnupg&quot;
actions:
  packages:
    - name: gpg
    - name: pinentry-gnome3
      platform: linux
    - name: pinentry-mac
      platform: macos
link-files:
  gpg.conf: &quot;{{gpg_home}}/gpg.conf&quot;
  &quot;gpg-agent-{{platform_os}}.conf&quot;: &quot;{{gpg_home}}/gpg-agent.conf&quot;
run-after: gpg --list-keys
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
